<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dropdown Example</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <!-- Bootstrap JS (Popper.js included) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body class="container mt-5">

  <div class="row">
    <div class="col-md-6">
      <label for="cancerData" class="form-label">Select the Cancer Data:</label>
      <select id="cancerData" class="form-select">
        <option disabled selected>Select country</option>
        <option value="germany">Germany</option>
        <option value="suiss">Switzerland</option>
        <option value="canada">Canada</option>
        <option value="usa">USA</option>
      </select>
    </div>
  </div>

  <div class="row mt-3">
    <div class="col-md-6">
      <div id="my_dataviz"></div>
    </div>
  </div>
  <div id="heatmap-container"></div>

  <script>
    $(document).ready(function() {
      // Event listener for dropdown change
      $('#cancerData').on('change', function() {
        // Get the selected value
        var selectedValue = $(this).val();
        console.log(selectedValue)
        // Make an AJAX request to the corresponding Flask route
        $.ajax({
          url: '/' + selectedValue,
          type: 'GET',
          success: function(data) {
            // Assuming data is the response from the Flask route
            // Update the result div with the received data
            // Call the function to create the heatmap
            Heatmap(data);
          },
          error: function(error) {
            console.error('Error:', error);
          }
        });
      });
    });





function Heatmap(data) {

d3.select("#my_dataviz").select("svg").remove();

var margin = { top: 80, right: 25, bottom: 30, left: 250 },
    width = 900 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

// Increase the width of the SVG canvas
var totalWidth = width + margin.left + margin.right + 250; // Adjust as needed

var svg = d3.select("#my_dataviz")
    .append("svg")
    .attr("width", totalWidth)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var myGroups = Object.keys(data[0]).filter(function (key) {
    return key !== "CancerSite";
});

var myVars = data.map(function (d) {
    return d.CancerSite;
});

var x = d3.scaleBand()
    .range([0, width])
    .domain(myGroups)
    .padding(0.05);

svg.append("g")
    .style("font-size", 15)
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).tickSize(0))
    .select(".domain").remove();

var y = d3.scaleBand()
    .range([height, 0])
    .domain(myVars)
    .padding(0.05);

svg.append("g")
    .style("font-size", 15)
    .call(d3.axisLeft(y).tickSize(0))
    .select(".domain").remove();


var myColor = d3.scaleSequential()
    .interpolator(d3.interpolateYlOrRd)
    .domain([0.00, 50.00]);


var tooltip = d3.select("#my_dataviz")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px");

var mouseover = function (d) {
    tooltip
        .style("opacity", 1);
    d3.select(this)
        .style("stroke", "black")
        .style("opacity", 1);
};
var mousemove = function (d) {
    tooltip
        .html("The exact value of<br>this cell is: " + d.value)
        .style("left", (d3.mouse(this)[0] + 70) + "px")
        .style("top", (d3.mouse(this)[1]) + "px");
};
var mouseleave = function (d) {
    tooltip
        .style("opacity", 0);
    d3.select(this)
        .style("stroke", "none")
        .style("opacity", 0.8);
};

var heatmap = svg.selectAll()
    .data(data)
    .enter()
    .append("g");

heatmap.selectAll("rect")
    .data(function (d) {
        return myGroups.map(function (myGroup) {
            return { CancerSite: d.CancerSite, age: myGroup, value: d[myGroup] };
        });
    })
    .enter()
    .append("rect")
    .attr("x", function (d) {
        return x(d.age);
    })
    .attr("y", function (d) {
        return y(d.CancerSite);
    })
    .attr("width", x.bandwidth())
    .attr("height", y.bandwidth())
    .style("fill", function (d) {
        return myColor(d.value);
    })
    .style("stroke-width", 4)
    .style("stroke", "none")
    .style("opacity", 0.8)
    .on("mouseover", mouseover)
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave);



svg.append("text")
    .attr("x", 0)
    .attr("y", -50)
    .attr("text-anchor", "left")
    .style("font-size", "22px")
    .text("Cancer Crude Rates");

svg.append("text")
    .attr("x", 0)
    .attr("y", -20)
    .attr("text-anchor", "left")
    .style("font-size", "14px")
    .style("fill", "grey")
    .style("max-width", 400)
    .text("Demographic cancer crude rates for each cancer site and age group from 5 years to 85.");

/// Add legend
var legend = svg.append("g")
    .attr("transform", "translate(" + (width + 20) + ",0)");

var legendTitle = legend.append("text")
    .attr("x", 0)
    .attr("y", -20)
    .attr("text-anchor", "left")
    .style("font-size", "14px")
    .style("fill", "grey")
    .text("Color Range");

// Create color scale for legend with a domain from 0 to 50
var legendColor = d3.scaleSequential()
    .interpolator(d3.interpolateYlOrRd)
    .domain([0, 50]);

// Create legend rectangles with colors
legend.selectAll("rect")
    .data(legendColor.ticks(6))
    .enter().append("rect")
    .attr("height", 20)
    .attr("width", 20)
    .attr("y", function (d, i) { return i * 20; })
    .style("fill", function (d) { return legendColor(d); });

// Create legend labels
legend.selectAll("text")
    .data(legendColor.ticks(6))
    .enter().append("text")
    .attr("y", function (d, i) { return i * 20 + 14; }) // Adjusted y position for better alignment
    .attr("x", 30)
    .style("text-anchor", "start")
    .text(function (d) { return d.toFixed(2); });

}








</script>
</body>
</html>






  </script>

</body>
</html>

