<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dropdown Example</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <!-- Bootstrap JS (Popper.js included) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body class="container mt-5">

  <div class="row">
    <div class="col-md-6">
      <label for="cancerData" class="form-label">Select the Cancer Data:</label>
      <select id="cancerData" class="form-select">
        <option disabled selected>Select country</option>
        <option value="germany">Germany</option>
        <option value="suiss">Switzerland</option>
        <option value="canada">Canada</option>
        <option value="usa">USA</option>
      </select>
    </div>
  </div>

  <div class="row mt-3">
    <div class="col-md-6">
      <div id="my_dataviz"></div>
    </div>
  </div>
  <div id="heatmap-container"></div>

  <script>
    $(document).ready(function() {
      // Event listener for dropdown change
      $('#cancerData').on('change', function() {
        // Get the selected value
        var selectedValue = $(this).val();
        console.log(selectedValue)
        // Make an AJAX request to the corresponding Flask route
        $.ajax({
          url: '/' + selectedValue,
          type: 'GET',
          success: function(data) {
            // Assuming data is the response from the Flask route
            // Update the result div with the received data
            console.log(data)
            // Call the function to create the heatmap
            createHeatmap(data);
            Heatmap(data);
          },
          error: function(error) {
            console.error('Error:', error);
          }
        });
      });
    });

    // heatmap.js
function createHeatmap(data) {
    d3.select("#heatmap-container").select("svg").remove();
    var margin = { top: 100, right: 50, bottom: 50, left: 200 };
    var width = 800 - margin.left - margin.right;
    var height = 600 - margin.top - margin.bottom;

    // Create SVG container
    var svg = d3.select("#heatmap-container")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Extract age groups and cancer sites
    var ageGroups = Object.keys(data[0]).filter(function (key) {
        return key !== "CancerSite";
    });

    var cancerSites = data.map(function (d) {
        return d.CancerSite;
    });

    // Create logarithmic color scale
    var colorScale = d3.scaleLog()
        .range(['white', 'blue'])
        .domain([0.01, 400.0]);


    // Create heatmap rectangles
    var heatmap = svg.selectAll(".heatmap")
        .data(data)
        .enter().append("g")
        .attr("transform", function (d) {
            return "translate(0," + cancerSites.indexOf(d.CancerSite) * (height / cancerSites.length) + ")";
        });

    heatmap.selectAll("rect")
        .data(function (d) {
            return ageGroups.map(function (ageGroup) {
                return { ageGroup: ageGroup, value: d[ageGroup] };
            });
        })
        .enter().append("rect")
        .attr("x", function (d) {
            return ageGroups.indexOf(d.ageGroup) * (width / ageGroups.length);
        })
        .attr("width", width / ageGroups.length)
        .attr("height", height / cancerSites.length)
        .style("fill", function (d) {
            return colorScale(d.value);
        });

    // Display actual values inside each cell
    heatmap.selectAll("text")
        .data(function (d) {
            return ageGroups.map(function (ageGroup) {
                return { ageGroup: ageGroup, value: d[ageGroup] };
            });
        })
        .enter().append("text")
        .attr("x", function (d) {
            return ageGroups.indexOf(d.ageGroup) * (width / ageGroups.length) + (width / ageGroups.length) / 2;
        })
        .attr("y", function (d) {
            return cancerSites.indexOf(d.CancerSite) * (height / cancerSites.length) + (height / cancerSites.length) / 2;
        })
        .attr("dy", ".35em")
        .style("text-anchor", "middle")
        .style("fill", "black")
        .text(function (d) {
            return d.value;
        });

    // Add labels on Y-axis
    svg.selectAll(".y-label")
        .data(cancerSites)
        .enter().append("text")
        .attr("class", "y-label")
        .attr("x", -10)
        .attr("y", function (d, i) {
            return i * (height / cancerSites.length) + height / (2 * cancerSites.length);
        })
        .attr("dy", ".35em")
        .style("text-anchor", "end")
        .text(function (d) {
            return d;
        });

    // Add labels on X-axis
    svg.selectAll(".x-label")
        .data(ageGroups)
        .enter().append("text")
        .attr("class", "x-label")
        .attr("x", function (d, i) {
            return i * (width / ageGroups.length) + width / (2 * ageGroups.length);
        })
        .attr("y", height + 10)
        .attr("dy", ".35em")
        .style("text-anchor", "middle")
        .text(function (d) {
            return d;
        });

    
    // Add title
    svg.append("text")
        .attr("x", width / 2)
        .attr("y", -margin.top / 2)  // Adjusted title position
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .style("font-size", "20px")
        .text("Cancer Rates Heatmap");

}



function Heatmap(data) {

d3.select("#my_dataviz").select("svg").remove();

var margin = { top: 80, right: 25, bottom: 30, left: 250 },
    width = 800 - margin.left - margin.right,  // Increased width
    height = 500 - margin.top - margin.bottom;

var svg = d3.select("#my_dataviz")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var myGroups = Object.keys(data[0]).filter(function (key) {
    return key !== "CancerSite";
});

var myVars = data.map(function (d) {
    return d.CancerSite;
});

// Adjusted x scale for wider cells and increased spacing
var x = d3.scaleBand()
    .range([0, width])
    .domain(myGroups)
    .padding(0.1); // Adjust padding

svg.append("g")
    .style("font-size", 15)
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).tickSize(0))
    .select(".domain").remove();

// Adjusted y scale for increased spacing
var y = d3.scaleBand()
    .range([height, 0])
    .domain(myVars)
    .padding(0.1); // Adjust padding

svg.append("g")
    .style("font-size", 15)
    .call(d3.axisLeft(y).tickSize(0))
    .select(".domain").remove();

var myColor = d3.scaleSequential()
    .interpolator(d3.interpolateYlGnBu)
    .domain([0.01, 400.0]);

var tooltip = d3.select("#my_dataviz")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px");

var mouseover = function (d) {
    tooltip
        .style("opacity", 1);
    d3.select(this)
        .style("stroke", "black")
        .style("opacity", 1);
};
var mousemove = function (d) {
    tooltip
        .html("The exact value of<br>this cell is: " + d.value)
        .style("left", (d3.mouse(this)[0] + 70) + "px")
        .style("top", (d3.mouse(this)[1]) + "px");
};
var mouseleave = function (d) {
    tooltip
        .style("opacity", 0);
    d3.select(this)
        .style("stroke", "none")
        .style("opacity", 0.8);
};

var heatmap = svg.selectAll()
    .data(data)
    .enter()
    .append("g");

heatmap.selectAll("rect")
    .data(function (d) {
        return myGroups.map(function (myGroup) {
            return { CancerSite: d.CancerSite, age: myGroup, value: d[myGroup] };
        });
    })
    .enter()
    .append("rect")
    .attr("x", function (d) {
        return x(d.age);
    })
    .attr("y", function (d) {
        return y(d.CancerSite);
    })
    .attr("width", x.bandwidth())
    .attr("height", y.bandwidth())
    .style("fill", function (d) {
        return myColor(d.value);
    })
    .style("stroke-width", 4)
    .style("stroke", "none")
    .style("opacity", 0.8)
    .on("mouseover", mouseover)
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave);

heatmap.selectAll("text")
    .data(function (d) {
        return myGroups.map(function (myGroup) {
            return { CancerSite: d.CancerSite, age: myGroup, value: d[myGroup] };
        });
    })
    .enter().append("text")
    .attr("x", function (d) {
        return x(d.age) + x.bandwidth() / 2;
    })
    .attr("y", function (d) {
        return y(d.CancerSite) + y.bandwidth() / 2;
    })
    .attr("dy", ".35em")
    .style("text-anchor", "middle")
    .style("fill", "black")
    .text(function (d) {
        return d.value;
    });

svg.append("text")
    .attr("x", 0)
    .attr("y", -50)
    .attr("text-anchor", "left")
    .style("font-size", "22px")
    .text("Cancer Crude Rates");

svg.append("text")
    .attr("x", 0)
    .attr("y", -20)
    .attr("text-anchor", "left")
    .style("font-size", "14px")
    .style("fill", "grey")
    .style("max-width", 400)
    .text("Demographic cancer crude rates for each cancer site and age group from 5 years to 85.");
}





</script>
</body>
</html>






  </script>

</body>
</html>

