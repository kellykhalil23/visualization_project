<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dropdown Example</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <!-- Bootstrap JS (Popper.js included) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body class="container mt-5">

  <div class="row">
    <div class="col-md-6">
      <label for="cancerData" class="form-label">Select the Cancer Data:</label>
      <select id="cancerData" class="form-select">
        <option disabled selected>Select country</option>
        <option value="germany">Germany</option>
        <option value="suiss">Switzerland</option>
        <option value="canada">Canada</option>
        <option value="usa">USA</option>
      </select>
    </div>
  </div>

  <div class="row mt-3">
    <div class="col-md-6">
      <div id="result"></div>
    </div>
  </div>
  <div id="heatmap-container"></div>
  <script>
    $(document).ready(function() {
      // Event listener for dropdown change
      $('#cancerData').on('change', function() {
        // Get the selected value
        var selectedValue = $(this).val();
        console.log(selectedValue)
        // Make an AJAX request to the corresponding Flask route
        $.ajax({
          url: '/' + selectedValue,
          type: 'GET',
          success: function(data) {
            // Assuming data is the response from the Flask route
            // Update the result div with the received data
            console.log(data)
            // Call the function to create the heatmap
            createHeatmap(data);
          },
          error: function(error) {
            console.error('Error:', error);
          }
        });
      });
    });

    // heatmap.js
function createHeatmap(data) {
    d3.select("#heatmap-container").select("svg").remove();
    var margin = { top: 100, right: 50, bottom: 50, left: 200 };
    var width = 800 - margin.left - margin.right;
    var height = 600 - margin.top - margin.bottom;

    // Create SVG container
    var svg = d3.select("#heatmap-container")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Extract age groups and cancer sites
    var ageGroups = Object.keys(data[0]).filter(function (key) {
        return key !== "CancerSite";
    });

    var cancerSites = data.map(function (d) {
        return d.CancerSite;
    });

    // Create logarithmic color scale
    var colorScale = d3.scaleLog()
        .range(["white", "blue"])  // Adjust the color range as needed
        .domain([1, d3.max(data, function (d) {
            return d3.max(ageGroups, function (ageGroup) {
                return d[ageGroup];
            });
        })]);

    // Create heatmap rectangles
    var heatmap = svg.selectAll(".heatmap")
        .data(data)
        .enter().append("g")
        .attr("transform", function (d) {
            return "translate(0," + cancerSites.indexOf(d.CancerSite) * (height / cancerSites.length) + ")";
        });

    heatmap.selectAll("rect")
        .data(function (d) {
            return ageGroups.map(function (ageGroup) {
                return { ageGroup: ageGroup, value: d[ageGroup] };
            });
        })
        .enter().append("rect")
        .attr("x", function (d) {
            return ageGroups.indexOf(d.ageGroup) * (width / ageGroups.length);
        })
        .attr("width", width / ageGroups.length)
        .attr("height", height / cancerSites.length)
        .style("fill", function (d) {
            return colorScale(d.value);
        });

    // Display actual values inside each cell
    heatmap.selectAll("text")
        .data(function (d) {
            return ageGroups.map(function (ageGroup) {
                return { ageGroup: ageGroup, value: d[ageGroup] };
            });
        })
        .enter().append("text")
        .attr("x", function (d) {
            return ageGroups.indexOf(d.ageGroup) * (width / ageGroups.length) + (width / ageGroups.length) / 2;
        })
        .attr("y", function (d) {
            return cancerSites.indexOf(d.CancerSite) * (height / cancerSites.length) + (height / cancerSites.length) / 2;
        })
        .attr("dy", ".35em")
        .style("text-anchor", "middle")
        .style("fill", "black")
        .text(function (d) {
            return d.value;
        });

    // Add labels on Y-axis
    svg.selectAll(".y-label")
        .data(cancerSites)
        .enter().append("text")
        .attr("class", "y-label")
        .attr("x", -10)
        .attr("y", function (d, i) {
            return i * (height / cancerSites.length) + height / (2 * cancerSites.length);
        })
        .attr("dy", ".35em")
        .style("text-anchor", "end")
        .text(function (d) {
            return d;
        });

    // Add labels on X-axis
    svg.selectAll(".x-label")
        .data(ageGroups)
        .enter().append("text")
        .attr("class", "x-label")
        .attr("x", function (d, i) {
            return i * (width / ageGroups.length) + width / (2 * ageGroups.length);
        })
        .attr("y", height + 10)
        .attr("dy", ".35em")
        .style("text-anchor", "middle")
        .text(function (d) {
            return d;
        });

    
    // Add title
    svg.append("text")
        .attr("x", width / 2)
        .attr("y", -margin.top / 2)  // Adjusted title position
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .style("font-size", "20px")
        .text("Cancer Rates Heatmap")
}










</script>
</body>
</html>






  </script>

</body>
</html>

